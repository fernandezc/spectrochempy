
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-42

.. code-block:: Python

    dataset.plot()



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 43-48

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 48-50

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 51-53

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 53-63

.. code-block:: Python

    model.fit(dataset)
    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.1401742102450199
    violation: 0.06158195065493241
    violation: 0.03477774452872506
    violation: 0.023155912689776643
    violation: 0.01628956483660717
    violation: 0.01173219772280977
    violation: 0.009261179153190097
    violation: 0.00777050252991445
    violation: 0.006957471610159029
    violation: 0.006457414370354937
    violation: 0.006191115125282079
    violation: 0.00605723897445765
    violation: 0.006000777806339562
    violation: 0.005868357891308897
    violation: 0.0058029180285339155
    violation: 0.0057723676588299095
    violation: 0.005756947971777899
    violation: 0.005733332889918821
    violation: 0.005700606624644899
    violation: 0.005667827078790888
    violation: 0.005587736630048282
    violation: 0.005529135183167032
    violation: 0.0054607606740759325
    violation: 0.005375194673451652
    violation: 0.005288054442075077
    violation: 0.005203284939611608
    violation: 0.005110269931845249
    violation: 0.005004969613317414
    violation: 0.004889401944567153
    violation: 0.004778610916794531
    violation: 0.004657040705272391
    violation: 0.0045276423083829825
    violation: 0.004393717477175013
    violation: 0.004267124138925589
    violation: 0.004133928133016071
    violation: 0.0040127559281388624
    violation: 0.003891465351926659
    violation: 0.0037652602700427116
    violation: 0.003637514821862717
    violation: 0.0035147101661543315
    violation: 0.0033965138303584373
    violation: 0.0032925205579803695
    violation: 0.0031941648132721686
    violation: 0.003104947029333603
    violation: 0.0030221674035500593
    violation: 0.0029389646390338333
    violation: 0.0028561158500458065
    violation: 0.0027738912186802585
    violation: 0.0026927116687367495
    violation: 0.0026129548289078046
    violation: 0.0025351644702122852
    violation: 0.002458740363437934
    violation: 0.002384202690790965
    violation: 0.0023133039094785524
    violation: 0.0022437367434809405
    violation: 0.002175116992578031
    violation: 0.0021084094490923444
    violation: 0.0020436678052478028
    violation: 0.001980664359350762
    violation: 0.0019243270194361371
    violation: 0.0018713261632056213
    violation: 0.0018195678200698174
    violation: 0.0017692749012866633
    violation: 0.0017204657491192309
    violation: 0.0016731692686994424
    violation: 0.0016274950351468735
    violation: 0.0015839173329700222
    violation: 0.0015418960309271446
    violation: 0.0015014385431313378
    violation: 0.0014629272012162756
    violation: 0.001426208132161991
    violation: 0.0013907597658090658
    violation: 0.0013601582805157781
    violation: 0.0013328464824004876
    violation: 0.0013065923988233666
    violation: 0.0012813357494812357
    violation: 0.0012569657401119544
    violation: 0.0012363658727398898
    violation: 0.0012190114699549297
    violation: 0.0011992116544502526
    violation: 0.00117756226245142
    violation: 0.001158260908541604
    violation: 0.0011389415923629667
    violation: 0.0011199124929359371
    violation: 0.0011006754884539144
    violation: 0.0010832777040276562
    violation: 0.0010661363692304933
    violation: 0.001049193369470458
    violation: 0.001031824410260689
    violation: 0.0010150792321235026
    violation: 0.0009988201809300544
    violation: 0.0009841318528818934
    violation: 0.0009699922960877332
    violation: 0.0009545966012007916
    violation: 0.000939636333138539
    violation: 0.0009266599168143926
    violation: 0.0009140262172603562
    violation: 0.000901587500637495
    violation: 0.0008902182357107134
    violation: 0.0008780499311871127
    violation: 0.0008660457470920358
    violation: 0.0008543517499940339
    violation: 0.0008428706003290866
    violation: 0.0008315536804373562
    violation: 0.0008208847158800844
    violation: 0.0008104269807764819
    violation: 0.0007997522484735678
    violation: 0.0007893350738954615
    violation: 0.0007791326607914365
    violation: 0.0007691414390017241
    violation: 0.0007597179067854629
    violation: 0.0007504652538892923
    violation: 0.0007412456856972057
    violation: 0.0007322966170540128
    violation: 0.0007235915691679752
    violation: 0.0007151920055398754
    violation: 0.0007069372346706295
    violation: 0.0006987637535244851
    violation: 0.0006907733550824822
    violation: 0.0006830298779797288
    violation: 0.0006754181243926808
    violation: 0.000667979593649037
    violation: 0.0006606893398232506
    violation: 0.0006536091296356471
    violation: 0.000646664112099795
    violation: 0.0006399762615476328
    violation: 0.0006335488650771132
    violation: 0.0006273957420691434
    violation: 0.000621523600071103
    violation: 0.0006161518203754866
    violation: 0.0006113918151772157
    violation: 0.0006071251736137255
    violation: 0.0006030938520873359
    violation: 0.0005992255771888033
    violation: 0.0005955122189364626
    violation: 0.0005919356405960039
    violation: 0.0005884735105285229
    violation: 0.0005851626197891255
    violation: 0.0005819472966807456
    violation: 0.0005788624242479181
    violation: 0.0005759087479597485
    violation: 0.0005730546137308388
    violation: 0.0005702968600985668
    violation: 0.000567605378718274
    violation: 0.0005650176785168492
    violation: 0.0005624480584365216
    violation: 0.0005599281471048985
    violation: 0.0005574208102718746
    violation: 0.0005549930907513093
    violation: 0.000552626309068727
    violation: 0.0005503237863511058
    violation: 0.0005480875748005765
    violation: 0.0005458976082892856
    violation: 0.0005437570853967841
    violation: 0.0005416726314727537
    violation: 0.0005396329582220719
    violation: 0.0005376381718608595
    violation: 0.0005358628850810564
    violation: 0.0005342566446346162
    violation: 0.0005327134944358679
    violation: 0.0005311700256180531
    violation: 0.0005296374901745524
    violation: 0.0005281469649351666
    violation: 0.0005266549474162921
    violation: 0.0005251860718892467
    violation: 0.0005237318107591918
    violation: 0.0005222955570666472
    violation: 0.0005208942964238217
    violation: 0.0005195265168845518
    violation: 0.0005181813428113167
    violation: 0.0005168846752738917
    violation: 0.0005156608680270882
    violation: 0.0005144616554312743
    violation: 0.000513289168819014
    violation: 0.0005121515266403412
    violation: 0.0005110364330891947
    violation: 0.0005099447315065868
    violation: 0.0005088753613790762
    violation: 0.0005078236610581641
    violation: 0.0005067909112022329
    violation: 0.0005057740763559627
    violation: 0.0005047767175617195
    violation: 0.0005037958933650049
    violation: 0.0005028222129275568
    violation: 0.0005018650428479644
    violation: 0.0005009224423797718
    violation: 0.0004999974962487013
    violation: 0.0004990872395196737
    violation: 0.0004981962000747655
    violation: 0.0004973147318191354
    violation: 0.0004964417296740759
    violation: 0.0004955753197882161
    violation: 0.0004946901218459137
    violation: 0.000493821043730265
    violation: 0.0004929673596845885
    violation: 0.0004921226355845303
    violation: 0.0004912871202791406
    violation: 0.0004904596528542953
    violation: 0.0004896376456531767
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.10/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.2781188101128491
    violation: 0.211038392734418
    violation: 0.1636589757375488
    violation: 0.1263812450285729
    violation: 0.0968939809285804
    violation: 0.07386553913526522
    violation: 0.0572630488363915
    violation: 0.04639710696895107
    violation: 0.03776270101072449
    violation: 0.030324671559648738
    violation: 0.02400007799857007
    violation: 0.01870505431885588
    violation: 0.014282427091628464
    violation: 0.010676123451468962
    violation: 0.0080165348273859
    violation: 0.006238616114828487
    violation: 0.005124394633030285
    violation: 0.0044907574796566535
    violation: 0.004053115751123498
    violation: 0.0037443026036689804
    violation: 0.003428962811660999
    violation: 0.003032319034755992
    violation: 0.0027272537391468295
    violation: 0.002386505694047078
    violation: 0.0020851628627841083
    violation: 0.0017697484695162599
    violation: 0.0014925716272857527
    violation: 0.0012488601974045082
    violation: 0.0010438675111377825
    violation: 0.0008573236692762625
    violation: 0.0006991377766200747
    violation: 0.0005706218431927088
    violation: 0.000463628624095578
    violation: 0.00037487235479901634
    violation: 0.00030325790844272694
    violation: 0.0002463663859384382
    violation: 0.000198258047904086
    violation: 0.00015827733519298905
    violation: 0.00012439075792817993
    violation: 9.61108960661687e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 64-66

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 66-67

.. code-block:: Python

    C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 69-75

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 76-78

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 78-80

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.277 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
