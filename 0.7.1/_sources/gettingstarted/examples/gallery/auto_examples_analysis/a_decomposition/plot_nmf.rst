
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-43

.. code-block:: Python

    _ = dataset.plot()




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 44-49

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 49-51

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 52-54

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 54-65

.. code-block:: Python

    _ = model.fit(dataset)

    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.14017421024501953
    violation: 0.06158195065493244
    violation: 0.0347777445287252
    violation: 0.023155912689776778
    violation: 0.016289564836607144
    violation: 0.011732197722809756
    violation: 0.009261179153190198
    violation: 0.007770502529914453
    violation: 0.006957471610159298
    violation: 0.006457414370355056
    violation: 0.00619111512528193
    violation: 0.006057238974457473
    violation: 0.006000777806339527
    violation: 0.005868357891308746
    violation: 0.005802918028533805
    violation: 0.005772367658829842
    violation: 0.005756947971777874
    violation: 0.005733332889918898
    violation: 0.0057006066246448875
    violation: 0.005667827078790964
    violation: 0.005587736630048383
    violation: 0.005529135183166962
    violation: 0.005460760674076107
    violation: 0.005375194673451656
    violation: 0.005288054442074981
    violation: 0.005203284939611535
    violation: 0.005110269931845125
    violation: 0.005004969613317571
    violation: 0.004889401944567118
    violation: 0.004778610916794535
    violation: 0.004657040705272687
    violation: 0.004527642308383311
    violation: 0.004393717477174861
    violation: 0.004267124138925786
    violation: 0.004133928133016188
    violation: 0.004012755928138649
    violation: 0.003891465351926734
    violation: 0.003765260270042624
    violation: 0.00363751482186303
    violation: 0.0035147101661544746
    violation: 0.003396513830358304
    violation: 0.003292520557980486
    violation: 0.0031941648132722835
    violation: 0.003104947029333505
    violation: 0.0030221674035500337
    violation: 0.0029389646390337986
    violation: 0.0028561158500457944
    violation: 0.002773891218680067
    violation: 0.0026927116687367188
    violation: 0.0026129548289077426
    violation: 0.002535164470212033
    violation: 0.002458740363437893
    violation: 0.002384202690790749
    violation: 0.0023133039094784687
    violation: 0.00224373674348078
    violation: 0.0021751169925787158
    violation: 0.0021084094490921596
    violation: 0.0020436678052480027
    violation: 0.0019806643593504956
    violation: 0.001924327019435945
    violation: 0.001871326163205682
    violation: 0.0018195678200700447
    violation: 0.0017692749012864193
    violation: 0.0017204657491192864
    violation: 0.0016731692686995962
    violation: 0.0016274950351468863
    violation: 0.001583917332970142
    violation: 0.001541896030927243
    violation: 0.00150143854313119
    violation: 0.0014629272012162485
    violation: 0.001426208132162119
    violation: 0.0013907597658089515
    violation: 0.00136015828051562
    violation: 0.0013328464824002878
    violation: 0.0013065923988233074
    violation: 0.0012813357494812275
    violation: 0.001256965740111946
    violation: 0.00123636587273979
    violation: 0.001219011469954927
    violation: 0.0011992116544500054
    violation: 0.0011775622624512155
    violation: 0.0011582609085414607
    violation: 0.0011389415923632109
    violation: 0.0011199124929360913
    violation: 0.0011006754884537707
    violation: 0.001083277704027843
    violation: 0.00106613636923057
    violation: 0.001049193369470185
    violation: 0.00103182441026062
    violation: 0.0010150792321235926
    violation: 0.000998820180930067
    violation: 0.0009841318528816486
    violation: 0.0009699922960876111
    violation: 0.0009545966012006246
    violation: 0.0009396363331388611
    violation: 0.00092665991681441
    violation: 0.0009140262172602855
    violation: 0.0009015875006378985
    violation: 0.0008902182357108122
    violation: 0.0008780499311873536
    violation: 0.0008660457470921146
    violation: 0.0008543517499939498
    violation: 0.0008428706003290392
    violation: 0.0008315536804371008
    violation: 0.0008208847158799954
    violation: 0.0008104269807764678
    violation: 0.000799752248473531
    violation: 0.0007893350738952521
    violation: 0.0007791326607915122
    violation: 0.0007691414390017119
    violation: 0.0007597179067854246
    violation: 0.0007504652538894524
    violation: 0.0007412456856973793
    violation: 0.000732296617054116
    violation: 0.0007235915691685292
    violation: 0.0007151920055395686
    violation: 0.000706937234670111
    violation: 0.0006987637535249563
    violation: 0.000690773355082457
    violation: 0.0006830298779799442
    violation: 0.0006754181243925295
    violation: 0.0006679795936493811
    violation: 0.0006606893398230804
    violation: 0.0006536091296352875
    violation: 0.0006466641120997357
    violation: 0.0006399762615477993
    violation: 0.0006335488650771541
    violation: 0.0006273957420693511
    violation: 0.0006215236000709559
    violation: 0.0006161518203755162
    violation: 0.0006113918151771195
    violation: 0.0006071251736137864
    violation: 0.0006030938520873853
    violation: 0.0005992255771885524
    violation: 0.0005955122189366126
    violation: 0.0005919356405959851
    violation: 0.0005884735105284037
    violation: 0.0005851626197890597
    violation: 0.0005819472966804975
    violation: 0.0005788624242479362
    violation: 0.0005759087479598469
    violation: 0.0005730546137310303
    violation: 0.0005702968600985
    violation: 0.000567605378718058
    violation: 0.0005650176785169061
    violation: 0.0005624480584370276
    violation: 0.0005599281471046024
    violation: 0.0005574208102719201
    violation: 0.0005549930907513362
    violation: 0.000552626309068807
    violation: 0.0005503237863511868
    violation: 0.0005480875748008446
    violation: 0.0005458976082893841
    violation: 0.0005437570853967764
    violation: 0.0005416726314724154
    violation: 0.0005396329582220243
    violation: 0.0005376381718606552
    violation: 0.0005358628850810204
    violation: 0.0005342566446342817
    violation: 0.0005327134944355445
    violation: 0.0005311700256179798
    violation: 0.0005296374901746512
    violation: 0.0005281469649350026
    violation: 0.0005266549474161944
    violation: 0.0005251860718892301
    violation: 0.0005237318107593327
    violation: 0.0005222955570666418
    violation: 0.0005208942964237734
    violation: 0.0005195265168845817
    violation: 0.0005181813428114047
    violation: 0.0005168846752737039
    violation: 0.0005156608680274216
    violation: 0.000514461655431248
    violation: 0.0005132891688188082
    violation: 0.0005121515266405032
    violation: 0.0005110364330896128
    violation: 0.0005099447315066327
    violation: 0.0005088753613793265
    violation: 0.0005078236610581038
    violation: 0.0005067909112024775
    violation: 0.0005057740763561175
    violation: 0.0005047767175615712
    violation: 0.0005037958933647039
    violation: 0.0005028222129278229
    violation: 0.000501865042848054
    violation: 0.0005009224423798155
    violation: 0.0004999974962487934
    violation: 0.0004990872395197759
    violation: 0.0004981962000748205
    violation: 0.0004973147318188009
    violation: 0.0004964417296740058
    violation: 0.0004955753197878881
    violation: 0.0004946901218457886
    violation: 0.000493821043730604
    violation: 0.0004929673596846696
    violation: 0.0004921226355845855
    violation: 0.0004912871202794576
    violation: 0.0004904596528543434
    violation: 0.0004896376456530348
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.10/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.27811881011284995
    violation: 0.21103839273441855
    violation: 0.1636589757375492
    violation: 0.12638124502857315
    violation: 0.09689398092858072
    violation: 0.07386553913526533
    violation: 0.05726304883639179
    violation: 0.04639710696895141
    violation: 0.03776270101072485
    violation: 0.030324671559649023
    violation: 0.024000077998570346
    violation: 0.018705054318856138
    violation: 0.014282427091628705
    violation: 0.010676123451469188
    violation: 0.008016534827386148
    violation: 0.00623861611482848
    violation: 0.005124394633030184
    violation: 0.004490757479656558
    violation: 0.004053115751123378
    violation: 0.00374430260366885
    violation: 0.0034289628116608672
    violation: 0.0030323190347559354
    violation: 0.002727253739146781
    violation: 0.0023865056940470266
    violation: 0.002085162862784095
    violation: 0.0017697484695162987
    violation: 0.0014925716272858201
    violation: 0.0012488601974045398
    violation: 0.001043867511137777
    violation: 0.0008573236692762524
    violation: 0.0006991377766200733
    violation: 0.0005706218431927322
    violation: 0.0004636286240955687
    violation: 0.0003748723547990182
    violation: 0.0003032579084427509
    violation: 0.0002463663859384818
    violation: 0.00019825804790409173
    violation: 0.00015827733519298433
    violation: 0.00012439075792818833
    violation: 9.611089606620183e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 66-68

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 68-70

.. code-block:: Python

    _ = C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 72-78

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 79-81

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 81-83

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.092 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
