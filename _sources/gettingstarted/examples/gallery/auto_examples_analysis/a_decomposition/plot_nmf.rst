
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-42

.. code-block:: Python

    dataset.plot()



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 43-48

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 48-50

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 51-53

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 53-63

.. code-block:: Python

    model.fit(dataset)
    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.14017421024501903
    violation: 0.06158195065493202
    violation: 0.03477774452872486
    violation: 0.023155912689776466
    violation: 0.01628956483660721
    violation: 0.011732197722809697
    violation: 0.00926117915319001
    violation: 0.007770502529914268
    violation: 0.006957471610159073
    violation: 0.006457414370354774
    violation: 0.006191115125282029
    violation: 0.006057238974457511
    violation: 0.006000777806339386
    violation: 0.005868357891308635
    violation: 0.005802918028533891
    violation: 0.005772367658829872
    violation: 0.005756947971777902
    violation: 0.005733332889918937
    violation: 0.005700606624644853
    violation: 0.005667827078790772
    violation: 0.005587736630048232
    violation: 0.005529135183167018
    violation: 0.005460760674075773
    violation: 0.005375194673451759
    violation: 0.005288054442075062
    violation: 0.005203284939611581
    violation: 0.005110269931845338
    violation: 0.005004969613317495
    violation: 0.0048894019445672905
    violation: 0.004778610916794685
    violation: 0.0046570407052726305
    violation: 0.004527642308383037
    violation: 0.004393717477175011
    violation: 0.004267124138925739
    violation: 0.004133928133016084
    violation: 0.004012755928138861
    violation: 0.0038914653519267557
    violation: 0.0037652602700426465
    violation: 0.0036375148218628227
    violation: 0.003514710166154359
    violation: 0.0033965138303582824
    violation: 0.00329252055798075
    violation: 0.0031941648132723876
    violation: 0.0031049470293335896
    violation: 0.0030221674035496773
    violation: 0.00293896463903398
    violation: 0.002856115850045689
    violation: 0.0027738912186801973
    violation: 0.002692711668736858
    violation: 0.0026129548289076437
    violation: 0.0025351644702120753
    violation: 0.0024587403634381165
    violation: 0.002384202690791334
    violation: 0.0023133039094781647
    violation: 0.002243736743480816
    violation: 0.0021751169925781693
    violation: 0.0021084094490923513
    violation: 0.0020436678052481337
    violation: 0.001980664359350544
    violation: 0.0019243270194361
    violation: 0.0018713261632056337
    violation: 0.0018195678200698848
    violation: 0.0017692749012867249
    violation: 0.001720465749119205
    violation: 0.0016731692686998458
    violation: 0.0016274950351468432
    violation: 0.0015839173329701046
    violation: 0.0015418960309272517
    violation: 0.0015014385431312892
    violation: 0.001462927201216167
    violation: 0.0014262081321619738
    violation: 0.0013907597658088563
    violation: 0.0013601582805157976
    violation: 0.0013328464824004884
    violation: 0.0013065923988232245
    violation: 0.0012813357494811893
    violation: 0.001256965740111896
    violation: 0.0012363658727398352
    violation: 0.0012190114699549657
    violation: 0.0011992116544501
    violation: 0.0011775622624514673
    violation: 0.0011582609085416258
    violation: 0.0011389415923631257
    violation: 0.001119912492935886
    violation: 0.0011006754884539728
    violation: 0.0010832777040276607
    violation: 0.0010661363692305453
    violation: 0.0010491933694697709
    violation: 0.0010318244102605443
    violation: 0.001015079232123773
    violation: 0.0009988201809301225
    violation: 0.0009841318528820214
    violation: 0.0009699922960876283
    violation: 0.0009545966012009913
    violation: 0.0009396363331386427
    violation: 0.000926659916814589
    violation: 0.0009140262172601915
    violation: 0.0009015875006378972
    violation: 0.0008902182357105723
    violation: 0.0008780499311870234
    violation: 0.0008660457470921662
    violation: 0.0008543517499939994
    violation: 0.0008428706003290972
    violation: 0.0008315536804368044
    violation: 0.0008208847158801547
    violation: 0.0008104269807765138
    violation: 0.0007997522484738348
    violation: 0.0007893350738953732
    violation: 0.0007791326607914012
    violation: 0.0007691414390015825
    violation: 0.0007597179067852314
    violation: 0.0007504652538890469
    violation: 0.0007412456856971327
    violation: 0.0007322966170540083
    violation: 0.0007235915691685969
    violation: 0.000715192005539962
    violation: 0.0007069372346705446
    violation: 0.0006987637535245039
    violation: 0.0006907733550826213
    violation: 0.0006830298779801538
    violation: 0.000675418124392599
    violation: 0.0006679795936492161
    violation: 0.0006606893398230505
    violation: 0.0006536091296353646
    violation: 0.0006466641120995507
    violation: 0.0006399762615474265
    violation: 0.0006335488650773025
    violation: 0.0006273957420688469
    violation: 0.0006215236000713136
    violation: 0.0006161518203755533
    violation: 0.0006113918151771337
    violation: 0.0006071251736136908
    violation: 0.0006030938520871724
    violation: 0.0005992255771886709
    violation: 0.0005955122189366152
    violation: 0.0005919356405961062
    violation: 0.0005884735105285953
    violation: 0.000585162619789125
    violation: 0.0005819472966804676
    violation: 0.0005788624242478854
    violation: 0.0005759087479598062
    violation: 0.0005730546137306498
    violation: 0.0005702968600985771
    violation: 0.0005676053787180591
    violation: 0.000565017678517015
    violation: 0.0005624480584366621
    violation: 0.0005599281471045184
    violation: 0.0005574208102719016
    violation: 0.0005549930907514688
    violation: 0.0005526263090685445
    violation: 0.0005503237863511397
    violation: 0.0005480875748007545
    violation: 0.0005458976082892489
    violation: 0.0005437570853969981
    violation: 0.0005416726314725992
    violation: 0.0005396329582221963
    violation: 0.0005376381718606582
    violation: 0.0005358628850808554
    violation: 0.0005342566446344081
    violation: 0.0005327134944358612
    violation: 0.0005311700256182138
    violation: 0.0005296374901747188
    violation: 0.0005281469649350641
    violation: 0.0005266549474163915
    violation: 0.0005251860718894549
    violation: 0.0005237318107589037
    violation: 0.000522295557066542
    violation: 0.0005208942964238475
    violation: 0.0005195265168841647
    violation: 0.0005181813428114921
    violation: 0.0005168846752735855
    violation: 0.0005156608680269206
    violation: 0.0005144616554310269
    violation: 0.0005132891688187896
    violation: 0.0005121515266404321
    violation: 0.000511036433089449
    violation: 0.0005099447315065123
    violation: 0.0005088753613791737
    violation: 0.0005078236610581573
    violation: 0.0005067909112026597
    violation: 0.0005057740763560911
    violation: 0.0005047767175616859
    violation: 0.0005037958933651127
    violation: 0.0005028222129275889
    violation: 0.0005018650428480095
    violation: 0.0005009224423799547
    violation: 0.0004999974962490276
    violation: 0.0004990872395199548
    violation: 0.0004981962000748044
    violation: 0.0004973147318189008
    violation: 0.0004964417296740012
    violation: 0.0004955753197878177
    violation: 0.0004946901218459188
    violation: 0.0004938210437306506
    violation: 0.0004929673596847756
    violation: 0.000492122635584646
    violation: 0.0004912871202792928
    violation: 0.0004904596528537377
    violation: 0.0004896376456530371
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.13/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.2781188101128538
    violation: 0.21103839273442115
    violation: 0.16365897573754973
    violation: 0.12638124502857237
    violation: 0.09689398092857915
    violation: 0.07386553913526364
    violation: 0.05726304883639103
    violation: 0.04639710696895068
    violation: 0.03776270101072399
    violation: 0.030324671559648093
    violation: 0.02400007799856938
    violation: 0.01870505431885517
    violation: 0.014282427091627787
    violation: 0.010676123451468412
    violation: 0.008016534827385678
    violation: 0.006238616114828257
    violation: 0.005124394633030062
    violation: 0.004490757479656492
    violation: 0.004053115751123336
    violation: 0.0037443026036688217
    violation: 0.0034289628116608946
    violation: 0.003032319034755851
    violation: 0.002727253739146724
    violation: 0.002386505694046975
    violation: 0.002085162862784018
    violation: 0.001769748469516187
    violation: 0.001492571627285705
    violation: 0.0012488601974044277
    violation: 0.0010438675111377146
    violation: 0.0008573236692761516
    violation: 0.0006991377766200429
    violation: 0.000570621843192674
    violation: 0.00046362862409552174
    violation: 0.00037487235479898674
    violation: 0.00030325790844270645
    violation: 0.00024636638593839597
    violation: 0.00019825804790409092
    violation: 0.00015827733519297558
    violation: 0.000124390757928168
    violation: 9.611089606617379e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 64-66

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 66-67

.. code-block:: Python

    C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 69-75

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 76-78

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 78-80

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.173 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
