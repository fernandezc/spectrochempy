
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-43

.. code-block:: Python

    _ = dataset.plot()




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 44-49

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 49-51

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 52-54

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 54-65

.. code-block:: Python

    _ = model.fit(dataset)

    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.14017421024501958
    violation: 0.06158195065493237
    violation: 0.03477774452872502
    violation: 0.02315591268977673
    violation: 0.016289564836607394
    violation: 0.011732197722809604
    violation: 0.009261179153190044
    violation: 0.00777050252991445
    violation: 0.006957471610159193
    violation: 0.006457414370354954
    violation: 0.0061911151252822165
    violation: 0.0060572389744576235
    violation: 0.00600077780633943
    violation: 0.005868357891308851
    violation: 0.0058029180285339476
    violation: 0.005772367658829991
    violation: 0.00575694797177788
    violation: 0.005733332889918903
    violation: 0.005700606624644891
    violation: 0.005667827078790947
    violation: 0.005587736630048226
    violation: 0.00552913518316705
    violation: 0.0054607606740758215
    violation: 0.005375194673451797
    violation: 0.005288054442075016
    violation: 0.005203284939611566
    violation: 0.0051102699318453185
    violation: 0.005004969613317627
    violation: 0.004889401944567266
    violation: 0.004778610916794606
    violation: 0.0046570407052726
    violation: 0.004527642308383182
    violation: 0.004393717477174984
    violation: 0.004267124138925785
    violation: 0.004133928133016157
    violation: 0.004012755928138739
    violation: 0.003891465351926717
    violation: 0.0037652602700425624
    violation: 0.0036375148218630612
    violation: 0.0035147101661543913
    violation: 0.0033965138303582603
    violation: 0.0032925205579806406
    violation: 0.0031941648132722774
    violation: 0.0031049470293336807
    violation: 0.0030221674035497774
    violation: 0.0029389646390337123
    violation: 0.0028561158500456834
    violation: 0.0027738912186804736
    violation: 0.002692711668736832
    violation: 0.002612954828907664
    violation: 0.002535164470212277
    violation: 0.0024587403634379313
    violation: 0.0023842026907915283
    violation: 0.0023133039094787064
    violation: 0.0022437367434808776
    violation: 0.002175116992578733
    violation: 0.0021084094490922464
    violation: 0.002043667805248078
    violation: 0.001980664359350492
    violation: 0.0019243270194359181
    violation: 0.0018713261632058902
    violation: 0.001819567820069583
    violation: 0.0017692749012866243
    violation: 0.0017204657491191413
    violation: 0.00167316926869971
    violation: 0.0016274950351470785
    violation: 0.001583917332970023
    violation: 0.0015418960309270969
    violation: 0.0015014385431313217
    violation: 0.0014629272012161504
    violation: 0.0014262081321619784
    violation: 0.0013907597658090569
    violation: 0.0013601582805156049
    violation: 0.0013328464824006166
    violation: 0.0013065923988230949
    violation: 0.0012813357494811707
    violation: 0.001256965740111855
    violation: 0.0012363658727399748
    violation: 0.0012190114699549455
    violation: 0.0011992116544499822
    violation: 0.0011775622624514781
    violation: 0.0011582609085417058
    violation: 0.0011389415923631107
    violation: 0.001119912492936248
    violation: 0.0011006754884538821
    violation: 0.0010832777040279257
    violation: 0.001066136369230763
    violation: 0.00104919336947013
    violation: 0.0010318244102608405
    violation: 0.0010150792321237598
    violation: 0.0009988201809299558
    violation: 0.0009841318528816265
    violation: 0.0009699922960875987
    violation: 0.0009545966012006924
    violation: 0.0009396363331385326
    violation: 0.0009266599168142821
    violation: 0.0009140262172599996
    violation: 0.0009015875006377061
    violation: 0.0008902182357106686
    violation: 0.0008780499311871353
    violation: 0.0008660457470920743
    violation: 0.0008543517499939338
    violation: 0.0008428706003286475
    violation: 0.0008315536804371567
    violation: 0.0008208847158799224
    violation: 0.0008104269807765588
    violation: 0.0007997522484735355
    violation: 0.0007893350738951802
    violation: 0.0007791326607913617
    violation: 0.0007691414390018503
    violation: 0.00075971790678506
    violation: 0.0007504652538891154
    violation: 0.0007412456856971114
    violation: 0.0007322966170539156
    violation: 0.0007235915691680365
    violation: 0.0007151920055396169
    violation: 0.0007069372346706508
    violation: 0.0006987637535250703
    violation: 0.0006907733550823985
    violation: 0.0006830298779798395
    violation: 0.0006754181243923353
    violation: 0.0006679795936494119
    violation: 0.000660689339823431
    violation: 0.0006536091296351864
    violation: 0.0006466641120994429
    violation: 0.0006399762615475125
    violation: 0.000633548865077568
    violation: 0.0006273957420693169
    violation: 0.0006215236000712951
    violation: 0.0006161518203757491
    violation: 0.0006113918151772117
    violation: 0.000607125173613548
    violation: 0.0006030938520874723
    violation: 0.0005992255771886947
    violation: 0.0005955122189364801
    violation: 0.0005919356405963409
    violation: 0.0005884735105286925
    violation: 0.000585162619789407
    violation: 0.0005819472966803311
    violation: 0.0005788624242481651
    violation: 0.0005759087479596303
    violation: 0.0005730546137309424
    violation: 0.0005702968600984593
    violation: 0.0005676053787181003
    violation: 0.0005650176785167869
    violation: 0.0005624480584368428
    violation: 0.0005599281471045194
    violation: 0.0005574208102720203
    violation: 0.0005549930907512375
    violation: 0.000552626309068711
    violation: 0.0005503237863512594
    violation: 0.0005480875748007572
    violation: 0.0005458976082893118
    violation: 0.0005437570853968928
    violation: 0.000541672631472803
    violation: 0.0005396329582220143
    violation: 0.000537638171860661
    violation: 0.0005358628850809362
    violation: 0.0005342566446342196
    violation: 0.0005327134944356419
    violation: 0.0005311700256183489
    violation: 0.0005296374901746627
    violation: 0.0005281469649347178
    violation: 0.0005266549474159256
    violation: 0.000525186071889106
    violation: 0.0005237318107591074
    violation: 0.000522295557066644
    violation: 0.0005208942964238612
    violation: 0.0005195265168843552
    violation: 0.000518181342811459
    violation: 0.0005168846752735492
    violation: 0.000515660868027173
    violation: 0.0005144616554311307
    violation: 0.0005132891688187598
    violation: 0.0005121515266400706
    violation: 0.0005110364330893635
    violation: 0.0005099447315065475
    violation: 0.0005088753613793932
    violation: 0.0005078236610581435
    violation: 0.0005067909112021852
    violation: 0.0005057740763559816
    violation: 0.000504776717561776
    violation: 0.0005037958933648147
    violation: 0.0005028222129279138
    violation: 0.0005018650428480025
    violation: 0.0005009224423797534
    violation: 0.0004999974962486802
    violation: 0.0004990872395195308
    violation: 0.0004981962000747727
    violation: 0.0004973147318190665
    violation: 0.0004964417296740626
    violation: 0.0004955753197880428
    violation: 0.0004946901218458807
    violation: 0.0004938210437304666
    violation: 0.0004929673596847831
    violation: 0.0004921226355847403
    violation: 0.0004912871202792048
    violation: 0.0004904596528539796
    violation: 0.0004896376456531144
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.10/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.27811881011285183
    violation: 0.21103839273441966
    violation: 0.1636589757375495
    violation: 0.1263812450285727
    violation: 0.09689398092857993
    violation: 0.07386553913526443
    violation: 0.05726304883639132
    violation: 0.04639710696895098
    violation: 0.03776270101072432
    violation: 0.030324671559648506
    violation: 0.024000077998569812
    violation: 0.018705054318855614
    violation: 0.014282427091628242
    violation: 0.010676123451468766
    violation: 0.00801653482738589
    violation: 0.006238616114828354
    violation: 0.005124394633030165
    violation: 0.004490757479656544
    violation: 0.004053115751123344
    violation: 0.0037443026036687887
    violation: 0.0034289628116608534
    violation: 0.0030323190347559246
    violation: 0.002727253739146747
    violation: 0.002386505694047042
    violation: 0.0020851628627840562
    violation: 0.001769748469516216
    violation: 0.0014925716272857549
    violation: 0.0012488601974044865
    violation: 0.0010438675111377907
    violation: 0.0008573236692762059
    violation: 0.0006991377766200609
    violation: 0.0005706218431927297
    violation: 0.00046362862409556055
    violation: 0.0003748723547989829
    violation: 0.0003032579084427397
    violation: 0.0002463663859384152
    violation: 0.00019825804790411073
    violation: 0.00015827733519298718
    violation: 0.00012439075792818177
    violation: 9.611089606615837e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 66-68

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 68-70

.. code-block:: Python

    _ = C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 72-78

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 79-81

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 81-83

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.244 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
