
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: default

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: default

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: default

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: default

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-43

.. code-block:: default

    _ = dataset.plot()




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 44-49

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 49-51

.. code-block:: default

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 52-54

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 54-65

.. code-block:: default

    _ = model.fit(dataset)

    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.1401742102450202
    violation: 0.061581950654932646
    violation: 0.034777744528725195
    violation: 0.02315591268977688
    violation: 0.016289564836607404
    violation: 0.011732197722809772
    violation: 0.009261179153190044
    violation: 0.007770502529914423
    violation: 0.006957471610159096
    violation: 0.006457414370354903
    violation: 0.006191115125282089
    violation: 0.006057238974457622
    violation: 0.0060007778063395
    violation: 0.005868357891308828
    violation: 0.005802918028533992
    violation: 0.0057723676588300665
    violation: 0.00575694797177798
    violation: 0.005733332889918873
    violation: 0.005700606624645048
    violation: 0.0056678270787906965
    violation: 0.0055877366300483185
    violation: 0.005529135183167072
    violation: 0.005460760674075866
    violation: 0.005375194673451784
    violation: 0.0052880544420751225
    violation: 0.005203284939611533
    violation: 0.00511026993184537
    violation: 0.0050049696133172925
    violation: 0.004889401944567292
    violation: 0.004778610916794598
    violation: 0.004657040705272498
    violation: 0.004527642308383002
    violation: 0.004393717477175035
    violation: 0.004267124138925779
    violation: 0.004133928133016032
    violation: 0.004012755928138965
    violation: 0.0038914653519266634
    violation: 0.0037652602700426843
    violation: 0.003637514821862681
    violation: 0.003514710166154244
    violation: 0.00339651383035834
    violation: 0.003292520557980286
    violation: 0.003194164813272258
    violation: 0.0031049470293335758
    violation: 0.003022167403549732
    violation: 0.002938964639033681
    violation: 0.002856115850045625
    violation: 0.0027738912186804545
    violation: 0.0026927116687366815
    violation: 0.002612954828907892
    violation: 0.0025351644702120623
    violation: 0.0024587403634382197
    violation: 0.0023842026907911896
    violation: 0.0023133039094783746
    violation: 0.0022437367434810554
    violation: 0.0021751169925786173
    violation: 0.002108409449092411
    violation: 0.002043667805247814
    violation: 0.0019806643593506703
    violation: 0.0019243270194361807
    violation: 0.0018713261632057883
    violation: 0.0018195678200698812
    violation: 0.001769274901286685
    violation: 0.0017204657491194297
    violation: 0.001673169268699605
    violation: 0.001627495035146798
    violation: 0.0015839173329701116
    violation: 0.0015418960309270654
    violation: 0.0015014385431314833
    violation: 0.0014629272012162682
    violation: 0.0014262081321618609
    violation: 0.001390759765808764
    violation: 0.0013601582805156571
    violation: 0.0013328464824005836
    violation: 0.0013065923988230981
    violation: 0.0012813357494814075
    violation: 0.001256965740112249
    violation: 0.001236365872739846
    violation: 0.001219011469954946
    violation: 0.0011992116544502771
    violation: 0.0011775622624513496
    violation: 0.0011582609085414388
    violation: 0.0011389415923631985
    violation: 0.0011199124929362671
    violation: 0.0011006754884538405
    violation: 0.0010832777040277505
    violation: 0.0010661363692306587
    violation: 0.0010491933694700667
    violation: 0.0010318244102607986
    violation: 0.0010150792321236537
    violation: 0.0009988201809299892
    violation: 0.0009841318528816352
    violation: 0.0009699922960878563
    violation: 0.0009545966012006873
    violation: 0.0009396363331385236
    violation: 0.0009266599168143833
    violation: 0.0009140262172603372
    violation: 0.0009015875006377831
    violation: 0.0008902182357106588
    violation: 0.0008780499311871423
    violation: 0.0008660457470921788
    violation: 0.0008543517499938326
    violation: 0.0008428706003285522
    violation: 0.0008315536804369277
    violation: 0.0008208847158800866
    violation: 0.0008104269807762321
    violation: 0.0007997522484733765
    violation: 0.0007893350738953887
    violation: 0.0007791326607912246
    violation: 0.0007691414390017824
    violation: 0.0007597179067852109
    violation: 0.0007504652538890781
    violation: 0.000741245685697112
    violation: 0.0007322966170541069
    violation: 0.0007235915691681666
    violation: 0.0007151920055397583
    violation: 0.0007069372346705382
    violation: 0.0006987637535248283
    violation: 0.0006907733550825826
    violation: 0.0006830298779801156
    violation: 0.0006754181243924998
    violation: 0.0006679795936492149
    violation: 0.0006606893398230322
    violation: 0.0006536091296354017
    violation: 0.0006466641120995639
    violation: 0.0006399762615476319
    violation: 0.0006335488650773832
    violation: 0.0006273957420688972
    violation: 0.0006215236000710584
    violation: 0.0006161518203754235
    violation: 0.000611391815177365
    violation: 0.0006071251736134496
    violation: 0.0006030938520875625
    violation: 0.000599225577188781
    violation: 0.0005955122189369479
    violation: 0.0005919356405963568
    violation: 0.0005884735105285633
    violation: 0.0005851626197889859
    violation: 0.000581947296680381
    violation: 0.00057886242424802
    violation: 0.0005759087479598719
    violation: 0.0005730546137306335
    violation: 0.000570296860098435
    violation: 0.0005676053787180846
    violation: 0.0005650176785172308
    violation: 0.0005624480584369804
    violation: 0.0005599281471044476
    violation: 0.0005574208102719263
    violation: 0.0005549930907514307
    violation: 0.0005526263090688057
    violation: 0.0005503237863513287
    violation: 0.0005480875748010649
    violation: 0.000545897608289512
    violation: 0.00054375708539683
    violation: 0.0005416726314727787
    violation: 0.0005396329582221116
    violation: 0.0005376381718606697
    violation: 0.0005358628850808824
    violation: 0.0005342566446342363
    violation: 0.0005327134944356907
    violation: 0.0005311700256180644
    violation: 0.0005296374901745716
    violation: 0.0005281469649350916
    violation: 0.0005266549474158936
    violation: 0.000525186071889597
    violation: 0.000523731810759252
    violation: 0.0005222955570663577
    violation: 0.0005208942964237991
    violation: 0.0005195265168842967
    violation: 0.0005181813428114807
    violation: 0.0005168846752737857
    violation: 0.0005156608680272101
    violation: 0.0005144616554311548
    violation: 0.000513289168818827
    violation: 0.0005121515266405028
    violation: 0.0005110364330894205
    violation: 0.0005099447315070215
    violation: 0.0005088753613791555
    violation: 0.00050782366105809
    violation: 0.0005067909112023772
    violation: 0.000505774076356315
    violation: 0.0005047767175611551
    violation: 0.0005037958933652883
    violation: 0.0005028222129279341
    violation: 0.0005018650428481512
    violation: 0.0005009224423801101
    violation: 0.0004999974962489835
    violation: 0.0004990872395196549
    violation: 0.0004981962000746726
    violation: 0.0004973147318189909
    violation: 0.0004964417296744543
    violation: 0.0004955753197882808
    violation: 0.0004946901218457966
    violation: 0.0004938210437304871
    violation: 0.0004929673596844985
    violation: 0.0004921226355845981
    violation: 0.0004912871202792713
    violation: 0.0004904596528540829
    violation: 0.0004896376456530191
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.10/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.27811881011285106
    violation: 0.2110383927344196
    violation: 0.16365897573754967
    violation: 0.1263812450285732
    violation: 0.09689398092858037
    violation: 0.07386553913526489
    violation: 0.05726304883639137
    violation: 0.04639710696895085
    violation: 0.037762701010724105
    violation: 0.03032467155964827
    violation: 0.024000077998569617
    violation: 0.018705054318855434
    violation: 0.014282427091628042
    violation: 0.010676123451468568
    violation: 0.008016534827385721
    violation: 0.0062386161148282136
    violation: 0.005124394633030071
    violation: 0.004490757479656512
    violation: 0.004053115751123362
    violation: 0.0037443026036688316
    violation: 0.0034289628116608794
    violation: 0.0030323190347559025
    violation: 0.002727253739146786
    violation: 0.0023865056940470374
    violation: 0.0020851628627840506
    violation: 0.0017697484695161486
    violation: 0.0014925716272856887
    violation: 0.0012488601974044733
    violation: 0.0010438675111377408
    violation: 0.0008573236692761926
    violation: 0.0006991377766200151
    violation: 0.0005706218431926675
    violation: 0.00046362862409552857
    violation: 0.00037487235479898246
    violation: 0.00030325790844270065
    violation: 0.00024636638593839206
    violation: 0.00019825804790408582
    violation: 0.0001582773351929722
    violation: 0.00012439075792817746
    violation: 9.611089606617434e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 66-68

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 68-70

.. code-block:: default

    _ = C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 72-78

.. code-block:: default

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 79-81

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 81-83

.. code-block:: default


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  1.266 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`
