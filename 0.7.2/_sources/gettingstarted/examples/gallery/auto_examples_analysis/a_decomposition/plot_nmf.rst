
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-42

.. code-block:: Python

    dataset.plot()



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 43-48

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 48-50

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 51-53

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 53-63

.. code-block:: Python

    model.fit(dataset)
    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.1401742102450207
    violation: 0.06158195065493295
    violation: 0.03477774452872538
    violation: 0.023155912689777132
    violation: 0.016289564836607602
    violation: 0.01173219772281001
    violation: 0.009261179153190203
    violation: 0.00777050252991461
    violation: 0.006957471610159203
    violation: 0.006457414370355119
    violation: 0.006191115125282167
    violation: 0.0060572389744576105
    violation: 0.006000777806339313
    violation: 0.005868357891308899
    violation: 0.005802918028533994
    violation: 0.005772367658830069
    violation: 0.005756947971777922
    violation: 0.005733332889918999
    violation: 0.005700606624644935
    violation: 0.00566782707879079
    violation: 0.005587736630048383
    violation: 0.005529135183166933
    violation: 0.005460760674076011
    violation: 0.005375194673451715
    violation: 0.005288054442075213
    violation: 0.0052032849396115525
    violation: 0.005110269931845392
    violation: 0.005004969613317457
    violation: 0.004889401944567329
    violation: 0.00477861091679481
    violation: 0.004657040705272405
    violation: 0.0045276423083829955
    violation: 0.004393717477175091
    violation: 0.00426712413892582
    violation: 0.004133928133016302
    violation: 0.004012755928138761
    violation: 0.0038914653519266746
    violation: 0.0037652602700425654
    violation: 0.003637514821862874
    violation: 0.0035147101661544876
    violation: 0.0033965138303582434
    violation: 0.0032925205579804663
    violation: 0.0031941648132722362
    violation: 0.003104947029333443
    violation: 0.003022167403550117
    violation: 0.0029389646390337453
    violation: 0.0028561158500459926
    violation: 0.0027738912186802732
    violation: 0.002692711668736765
    violation: 0.002612954828907774
    violation: 0.0025351644702118646
    violation: 0.0024587403634378667
    violation: 0.002384202690791163
    violation: 0.002313303909478543
    violation: 0.0022437367434810732
    violation: 0.002175116992578815
    violation: 0.0021084094490924532
    violation: 0.0020436678052478388
    violation: 0.001980664359350613
    violation: 0.0019243270194360409
    violation: 0.001871326163205829
    violation: 0.0018195678200695906
    violation: 0.0017692749012866178
    violation: 0.0017204657491191385
    violation: 0.0016731692686996846
    violation: 0.0016274950351468807
    violation: 0.0015839173329694682
    violation: 0.0015418960309272758
    violation: 0.0015014385431315243
    violation: 0.0014629272012159546
    violation: 0.0014262081321620359
    violation: 0.0013907597658087375
    violation: 0.0013601582805158167
    violation: 0.0013328464824003516
    violation: 0.0013065923988235262
    violation: 0.0012813357494812173
    violation: 0.0012569657401118538
    violation: 0.0012363658727396957
    violation: 0.0012190114699554423
    violation: 0.0011992116544501912
    violation: 0.001177562262451104
    violation: 0.0011582609085415267
    violation: 0.001138941592363026
    violation: 0.0011199124929360852
    violation: 0.0011006754884538704
    violation: 0.0010832777040275941
    violation: 0.0010661363692304306
    violation: 0.0010491933694699535
    violation: 0.0010318244102609426
    violation: 0.0010150792321233669
    violation: 0.000998820180929774
    violation: 0.0009841318528816035
    violation: 0.0009699922960876961
    violation: 0.000954596601200765
    violation: 0.0009396363331388866
    violation: 0.0009266599168145883
    violation: 0.0009140262172600351
    violation: 0.000901587500637788
    violation: 0.000890218235710631
    violation: 0.0008780499311868962
    violation: 0.0008660457470920907
    violation: 0.0008543517499940774
    violation: 0.000842870600328754
    violation: 0.000831553680437312
    violation: 0.0008208847158802517
    violation: 0.0008104269807768099
    violation: 0.0007997522484736415
    violation: 0.0007893350738951126
    violation: 0.000779132660791275
    violation: 0.000769141439002049
    violation: 0.0007597179067852087
    violation: 0.000750465253889354
    violation: 0.0007412456856972327
    violation: 0.0007322966170539791
    violation: 0.0007235915691682292
    violation: 0.0007151920055395464
    violation: 0.0007069372346701044
    violation: 0.0006987637535247462
    violation: 0.0006907733550823796
    violation: 0.0006830298779800946
    violation: 0.0006754181243922904
    violation: 0.0006679795936493031
    violation: 0.000660689339823227
    violation: 0.0006536091296351714
    violation: 0.0006466641120997347
    violation: 0.0006399762615477324
    violation: 0.0006335488650771383
    violation: 0.0006273957420688542
    violation: 0.0006215236000711077
    violation: 0.0006161518203756949
    violation: 0.0006113918151774246
    violation: 0.0006071251736134745
    violation: 0.0006030938520872485
    violation: 0.0005992255771888247
    violation: 0.0005955122189365715
    violation: 0.0005919356405962224
    violation: 0.0005884735105289342
    violation: 0.0005851626197892354
    violation: 0.0005819472966806082
    violation: 0.0005788624242483824
    violation: 0.0005759087479596884
    violation: 0.0005730546137311973
    violation: 0.0005702968600983124
    violation: 0.0005676053787181574
    violation: 0.0005650176785171128
    violation: 0.0005624480584370146
    violation: 0.0005599281471046976
    violation: 0.0005574208102719486
    violation: 0.0005549930907512913
    violation: 0.0005526263090689866
    violation: 0.0005503237863510375
    violation: 0.0005480875748007404
    violation: 0.000545897608289442
    violation: 0.0005437570853966821
    violation: 0.0005416726314724449
    violation: 0.0005396329582222407
    violation: 0.000537638171860628
    violation: 0.0005358628850810367
    violation: 0.000534256644634397
    violation: 0.0005327134944355888
    violation: 0.0005311700256179102
    violation: 0.0005296374901746848
    violation: 0.0005281469649344817
    violation: 0.0005266549474163599
    violation: 0.0005251860718894165
    violation: 0.0005237318107590404
    violation: 0.0005222955570662929
    violation: 0.0005208942964238268
    violation: 0.0005195265168843473
    violation: 0.0005181813428112135
    violation: 0.0005168846752736979
    violation: 0.0005156608680269334
    violation: 0.0005144616554311503
    violation: 0.0005132891688189646
    violation: 0.00051215152664043
    violation: 0.00051103643308912
    violation: 0.0005099447315064922
    violation: 0.0005088753613791896
    violation: 0.0005078236610584066
    violation: 0.0005067909112027668
    violation: 0.0005057740763559118
    violation: 0.0005047767175613851
    violation: 0.0005037958933649964
    violation: 0.0005028222129280551
    violation: 0.0005018650428480734
    violation: 0.0005009224423799545
    violation: 0.0004999974962488595
    violation: 0.0004990872395197216
    violation: 0.0004981962000749444
    violation: 0.0004973147318189607
    violation: 0.0004964417296737671
    violation: 0.0004955753197883976
    violation: 0.0004946901218458371
    violation: 0.000493821043730538
    violation: 0.0004929673596843673
    violation: 0.0004921226355844438
    violation: 0.0004912871202790315
    violation: 0.0004904596528543445
    violation: 0.000489637645653121
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.10/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.27811881011286194
    violation: 0.21103839273442646
    violation: 0.1636589757375531
    violation: 0.1263812450285741
    violation: 0.09689398092857984
    violation: 0.07386553913526377
    violation: 0.0572630488363904
    violation: 0.04639710696894989
    violation: 0.037762701010723064
    violation: 0.03032467155964698
    violation: 0.024000077998568275
    violation: 0.018705054318854063
    violation: 0.014282427091626674
    violation: 0.01067612345146749
    violation: 0.008016534827385026
    violation: 0.00623861611482772
    violation: 0.00512439463302994
    violation: 0.00449075747965658
    violation: 0.0040531157511235014
    violation: 0.0037443026036690463
    violation: 0.003428962811661006
    violation: 0.003032319034756006
    violation: 0.0027272537391468564
    violation: 0.0023865056940470626
    violation: 0.0020851628627840753
    violation: 0.0017697484695161478
    violation: 0.0014925716272856469
    violation: 0.0012488601974043596
    violation: 0.0010438675111376628
    violation: 0.00085732366927611
    violation: 0.0006991377766199716
    violation: 0.0005706218431926299
    violation: 0.00046362862409549365
    violation: 0.0003748723547989509
    violation: 0.0003032579084426757
    violation: 0.0002463663859383908
    violation: 0.00019825804790406807
    violation: 0.00015827733519294864
    violation: 0.0001243907579281422
    violation: 9.611089606613676e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 64-66

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 66-67

.. code-block:: Python

    C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 69-75

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 76-78

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 78-80

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.102 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
