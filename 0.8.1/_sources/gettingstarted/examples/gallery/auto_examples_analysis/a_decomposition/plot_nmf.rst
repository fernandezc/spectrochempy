
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-42

.. code-block:: Python

    dataset.plot()



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 43-48

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 48-50

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 51-53

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 53-63

.. code-block:: Python

    model.fit(dataset)
    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.14017421024502005
    violation: 0.06158195065493243
    violation: 0.03477774452872505
    violation: 0.023155912689776726
    violation: 0.01628956483660741
    violation: 0.011732197722809774
    violation: 0.009261179153190038
    violation: 0.007770502529914427
    violation: 0.0069574716101590585
    violation: 0.006457414370354931
    violation: 0.006191115125281949
    violation: 0.006057238974457682
    violation: 0.0060007778063394445
    violation: 0.005868357891308902
    violation: 0.005802918028533731
    violation: 0.005772367658829901
    violation: 0.005756947971777843
    violation: 0.005733332889918998
    violation: 0.00570060662464481
    violation: 0.005667827078790878
    violation: 0.005587736630048415
    violation: 0.005529135183167044
    violation: 0.00546076067407594
    violation: 0.0053751946734517985
    violation: 0.0052880544420750705
    violation: 0.00520328493961171
    violation: 0.005110269931845192
    violation: 0.005004969613317587
    violation: 0.004889401944567068
    violation: 0.004778610916794672
    violation: 0.004657040705272617
    violation: 0.004527642308383082
    violation: 0.004393717477174952
    violation: 0.004267124138925598
    violation: 0.004133928133016174
    violation: 0.00401275592813873
    violation: 0.0038914653519268533
    violation: 0.0037652602700427216
    violation: 0.0036375148218629034
    violation: 0.0035147101661543493
    violation: 0.0033965138303582434
    violation: 0.0032925205579803184
    violation: 0.003194164813272314
    violation: 0.0031049470293333793
    violation: 0.0030221674035498156
    violation: 0.002938964639033736
    violation: 0.0028561158500457623
    violation: 0.002773891218680256
    violation: 0.002692711668736771
    violation: 0.00261295482890788
    violation: 0.0025351644702121382
    violation: 0.002458740363438216
    violation: 0.0023842026907909958
    violation: 0.002313303909478681
    violation: 0.0022437367434808542
    violation: 0.0021751169925786
    violation: 0.002108409449092446
    violation: 0.002043667805248008
    violation: 0.0019806643593506487
    violation: 0.0019243270194361215
    violation: 0.0018713261632057143
    violation: 0.0018195678200696543
    violation: 0.0017692749012868136
    violation: 0.0017204657491189659
    violation: 0.0016731692686996736
    violation: 0.001627495035147008
    violation: 0.001583917332970053
    violation: 0.0015418960309271207
    violation: 0.001501438543131372
    violation: 0.0014629272012162714
    violation: 0.0014262081321621298
    violation: 0.0013907597658090827
    violation: 0.001360158280515774
    violation: 0.0013328464824006033
    violation: 0.0013065923988233002
    violation: 0.0012813357494812743
    violation: 0.001256965740111758
    violation: 0.0012363658727398553
    violation: 0.0012190114699549615
    violation: 0.001199211654450039
    violation: 0.0011775622624512951
    violation: 0.001158260908541707
    violation: 0.0011389415923631773
    violation: 0.0011199124929364272
    violation: 0.0011006754884539747
    violation: 0.0010832777040279964
    violation: 0.001066136369230568
    violation: 0.0010491933694700716
    violation: 0.0010318244102608598
    violation: 0.00101507923212357
    violation: 0.0009988201809300308
    violation: 0.0009841318528818661
    violation: 0.00096999229608776
    violation: 0.0009545966012008992
    violation: 0.0009396363331388212
    violation: 0.0009266599168143972
    violation: 0.000914026217259986
    violation: 0.0009015875006376972
    violation: 0.0008902182357105794
    violation: 0.0008780499311871935
    violation: 0.0008660457470917723
    violation: 0.0008543517499939321
    violation: 0.0008428706003288744
    violation: 0.0008315536804372102
    violation: 0.000820884715880192
    violation: 0.0008104269807762686
    violation: 0.0007997522484734631
    violation: 0.0007893350738955181
    violation: 0.0007791326607915151
    violation: 0.0007691414390016879
    violation: 0.0007597179067851944
    violation: 0.0007504652538891103
    violation: 0.0007412456856967773
    violation: 0.0007322966170539814
    violation: 0.0007235915691683822
    violation: 0.0007151920055395812
    violation: 0.0007069372346702285
    violation: 0.0006987637535246936
    violation: 0.0006907733550825392
    violation: 0.0006830298779798534
    violation: 0.0006754181243922593
    violation: 0.0006679795936493788
    violation: 0.0006606893398232987
    violation: 0.000653609129635658
    violation: 0.0006466641120996789
    violation: 0.000639976261547627
    violation: 0.0006335488650772622
    violation: 0.0006273957420690422
    violation: 0.0006215236000708792
    violation: 0.0006161518203757099
    violation: 0.0006113918151773992
    violation: 0.0006071251736133214
    violation: 0.0006030938520871657
    violation: 0.0005992255771887566
    violation: 0.0005955122189368667
    violation: 0.0005919356405962734
    violation: 0.000588473510528823
    violation: 0.0005851626197891469
    violation: 0.0005819472966807344
    violation: 0.0005788624242482088
    violation: 0.0005759087479597644
    violation: 0.0005730546137309832
    violation: 0.0005702968600984719
    violation: 0.0005676053787180564
    violation: 0.000565017678517149
    violation: 0.0005624480584365829
    violation: 0.0005599281471044067
    violation: 0.0005574208102720401
    violation: 0.0005549930907514067
    violation: 0.0005526263090686047
    violation: 0.000550323786351199
    violation: 0.0005480875748005208
    violation: 0.0005458976082894709
    violation: 0.0005437570853968739
    violation: 0.0005416726314725809
    violation: 0.0005396329582219073
    violation: 0.0005376381718607897
    violation: 0.000535862885081081
    violation: 0.0005342566446341443
    violation: 0.0005327134944358241
    violation: 0.0005311700256180837
    violation: 0.0005296374901746274
    violation: 0.000528146964935092
    violation: 0.0005266549474162787
    violation: 0.0005251860718896222
    violation: 0.0005237318107593135
    violation: 0.0005222955570667291
    violation: 0.0005208942964236862
    violation: 0.0005195265168841936
    violation: 0.0005181813428112657
    violation: 0.0005168846752734596
    violation: 0.0005156608680269267
    violation: 0.0005144616554310261
    violation: 0.0005132891688190346
    violation: 0.0005121515266404571
    violation: 0.000511036433089345
    violation: 0.0005099447315065078
    violation: 0.0005088753613789845
    violation: 0.0005078236610580344
    violation: 0.0005067909112022363
    violation: 0.0005057740763560637
    violation: 0.0005047767175615462
    violation: 0.0005037958933650536
    violation: 0.0005028222129276463
    violation: 0.0005018650428483064
    violation: 0.0005009224423799067
    violation: 0.000499997496248567
    violation: 0.0004990872395197812
    violation: 0.0004981962000748405
    violation: 0.0004973147318191131
    violation: 0.0004964417296739636
    violation: 0.0004955753197880261
    violation: 0.0004946901218460913
    violation: 0.0004938210437307757
    violation: 0.000492967359684531
    violation: 0.000492122635584565
    violation: 0.0004912871202789053
    violation: 0.0004904596528537845
    violation: 0.0004896376456532217
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.13/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.27811881011284983
    violation: 0.21103839273441857
    violation: 0.16365897573754878
    violation: 0.12638124502857248
    violation: 0.09689398092858
    violation: 0.0738655391352646
    violation: 0.05726304883639135
    violation: 0.04639710696895095
    violation: 0.03776270101072424
    violation: 0.030324671559648447
    violation: 0.024000077998569822
    violation: 0.018705054318855583
    violation: 0.014282427091628164
    violation: 0.01067612345146871
    violation: 0.008016534827385817
    violation: 0.006238616114828239
    violation: 0.00512439463303008
    violation: 0.00449075747965639
    violation: 0.0040531157511232395
    violation: 0.003744302603668724
    violation: 0.0034289628116607545
    violation: 0.00303231903475583
    violation: 0.002727253739146697
    violation: 0.0023865056940469923
    violation: 0.002085162862783988
    violation: 0.001769748469516198
    violation: 0.0014925716272857124
    violation: 0.0012488601974044358
    violation: 0.0010438675111377517
    violation: 0.0008573236692761933
    violation: 0.0006991377766200552
    violation: 0.0005706218431926927
    violation: 0.0004636286240955595
    violation: 0.00037487235479900257
    violation: 0.0003032579084427257
    violation: 0.00024636638593840616
    violation: 0.00019825804790409596
    violation: 0.00015827733519295444
    violation: 0.00012439075792816635
    violation: 9.611089606615995e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 64-66

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 66-67

.. code-block:: Python

    C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 69-75

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 76-78

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 78-80

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.128 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
